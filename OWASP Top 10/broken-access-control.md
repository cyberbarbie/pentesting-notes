# Broken Access Control
My favorite freaking web security vulnerability (so far...)

## What is Broken Access Control? 

 The most common web vulnerability according to OWASP Top 10 where you're able to access the data of another user of the same access level (horizontal privilege escalation), elevate to a user of higher access level like admin/root (vertical privilege escalation), or bypass the multi-step process of performing a user action (context-dependent). Ways to prevent it is by validating user input on the server side, testing your functions regularly to ensure proper access control, & deny access by default then implement and test access controls as you go. 

## Helpful Terminology
**Authentication** - Mechanism to identify and establish user identity (single sign on, username and password, sign in with social media)

**Session Management** - Identifies which subsequent HTTP requests are being made by each user (if you wanted to access parts of an application that requires authentication i.e. my account, my profile, inbox) it maintains that session w/o needing to re-authenticate every time; identifies HTTP requests made by each users and manages the session in each application; an application generates a unique token that's tied to user ID typically passed through a set-cookie in both the client browser and server and for all future requests they are sent with it; keep cookies secret; there is no session state between client and server because HTTP is stateless that's why you need a cookie to authenticate

**Access Control** - Mechanisms that determines whether user is allowed to carry out the action they're attempting to perform 

### Real-World Example of Access Control** - 
Sending money through friend - the session token gets sent with the request & backend will check with session token is valid for (specific user) and will check if DB if user is assigned any roles or any access control rules and will determine if you have permission to send money or not; for example, a normal user shouldn't access an admin page 

**Access control** - Used to restrict access to functions not available for other users in the organization (for example, a regular user shouldn't be able to access the endpoint  that allows you to delete any user in the application)

## Types of Broken Access Control

**Vertical privilege escalation** - Finding a type of broken access control vulnerability where you can perform actions reserved for elevated privileged users.

If the application relies on client-side input in order to make access control vulnerabilities 
Don't trust a user to put a dash or a single quote
You need to perform server-side validation

*Note*: In a real world pentest, you're given multiple accounts of different privilege levels and your first step is to map out the application to determine what functionality and parts of the application a user role has access to

Ex When logged in as admin 
	- You're given an admin panel link which lets you upgrade and downgrade privilege of users 

**Horizontal Access Control** - Restricts users of the same privilege from accessing similar resources (regular user #1 shouldn't be able to access the data of regular #2)

**Context-Dependent Access Control** - Restricts access to functionality & resources based on the state of the application or the user's interaction with it 
Ex:
**Scenario: You have a multi-step process for deleting a user**
	1. Click delete button and Generates a /confirm request which prompts you with a conformation page if you really wanted to delete that user 
	2. Click yes to confirm deletion
	3. Sends /delete request to delete user and prompts message of successful deletion 
There are several context/states - you shouldn't be able to go from step 1 to 3 automatically; ensures you follow the exact business rules implemented in the application in order to perform a set of actions 

If a developer assumes you only get to step #2 from #1 and only implements access control rules on #1 instead of #2 as well, it introduces 

**IDOR** - Insecure direct object reference; a type of access control vulnerability; when a web server fulfills a user input request to retrieve objects (files, data, documents) that hasn't been validates on the server side to confirm the user has access to requested data 

If the application trusts the client side input, you can change the user ID; anything coming from the client should be considered untrusted by default

**WTF is Burp suite** - all requests from the browser will get sent to the proxy then to the target application; a man in the middle proxy that intercepts requests from the application to server

API Key - Extract information from the client side and you want to extract cookies usually to steal their identity but can use the API key to retrieve other information so you never want to store it in the UI encrypted or unencrypted

Broken access controls can be accessed at the API level.

Methodology - Map the application and how it works, all the business logic, all the potential parameters that talk to the backend and determine where those vulnerabilities exist if access control rules have been implemented incorrect 

## Brief Overview of HTTP 
HTTP is a stateless protocol meaning it doesn't keep track of requests, instead you use something like cookies which will act as your unique identifier and will be sent with each subsequent HTTP request so the server remembers who you are. 


## HTTP Request Methods 

**GET** - Retrieve/view; less secure than POST because data is sent part of the URL
**DELETE** - delete a resource 
**PUT** - checking if resource exists then update else create new resource 
**POST** - create resource/can be used to update 
**PATCH** - Update aresource 

## Preventative Measures Against Broken Access Control
	- Use a security-centric design where access is verified first and ensure all requests go through access control check
	- Deny access by default when creating a new page and implement rules to grant access
	- Apply the principle of least privilege throughout the entire application
	- Log all access control events 
	- Access control checks should always be performed on the server side, never trust client-provided input 

## Helpful Links
These resources helped me learn how Broken Access Control works 
* [Learn Burp Suite Here](https://portswigger.net/burp/documentation/desktop/getting-started/intercepting-http-traffic?utm_source=burp_suite_community&utm_medium=learn_tab&utm_campaign=onboarding)
* [The Best Explanation of BAC](https://www.youtube.com/watch?v=WqbrB12Jvgc)
* [Prefer Hands-On Learning?](https://portswigger.net/web-security/access-control)